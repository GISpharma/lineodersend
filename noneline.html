<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GIS รายการสั่งซื้อ</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.20/dist/sweetalert2.min.css">
  <style>
    /* … your existing custom styles … */
    .NoPrint { white-space: nowrap; }
  </style>
</head>
<body>
  <div class="container" style="max-width:1080px;">

    <form id="myForm">
      <span class="input-group-text mb-0" style="
        margin-top:20px;
        border:#198754 1px solid;
        background-color:#0d5f39;
        color:white;
        padding:18px;
        border-radius:10px 10px 0 0;
        margin-bottom:-5px;
      ">
        บันทึกรายการสั่งซื้อ GISPHARMA
      </span>
      <div class="card">
        <div class="card-body">

          <!-- Row 1 -->
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="input-group mb-3">
                <span class="input-group-text">OrderID</span>
                <input type="text" id="keyInput" name="order_id" class="form-control" readonly>
              </div>
              <div class="input-group mb-3">
                <span class="input-group-text">เจ้าหน้าที่บันทึก</span>
                <input type="text" id="displayName" name="displayName" class="form-control" required>
              </div>
            </div>
            <div class="col-md-6">
              <div class="input-group mb-3">
                <span class="input-group-text">UserID</span>
                <input type="text" id="userId" name="userId" class="form-control" value="direct" required>
              </div>
            </div>
          </div>

          <!-- Row 2 -->
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="input-group mb-3">
                <span class="input-group-text">รหัสผู้ขาย</span>
                <input type="text" name="sell_id" class="form-control" required>
              </div>
              <div class="input-group mb-3">
                <span class="input-group-text">ประเภทลูกค้า</span>
                <select name="category" class="form-control" required>
                  <option value="">เลือกประเภท</option>
                  <option value="ร้านขายยา">ร้านขายยา</option>
                  <option value="คลีนิก">คลีนิก</option>
                  <option value="โรงพยาบาลรัฐ">โรงพยาบาลรัฐ</option>
                  <option value="โรงพยาบาลเอกชน">โรงพยาบาลเอกชน</option>
                  <option value="ร้าน/บริษัท/ขายส่ง">ร้าน/บริษัท/ขายส่ง</option>
                  <option value="ออนไลน์">ออนไลน์</option>
                </select>
              </div>
            </div>
            <div class="col-md-6">
              <div class="input-group mb-3">
                <span class="input-group-text">เลขใบสั่งซื้อ</span>
                <input type="text" name="ipo" class="form-control">
              </div>
              <div class="input-group mb-3">
                <span class="input-group-text">จังหวัด</span>
                <input list="provincesList" id="cityInput" name="city" class="form-control" required>
                <datalist id="provincesList">
                  <option value="กรุงเทพมหานคร">
                  <option value="กระบี่">
                  <option value="กาญจนบุรี">
                  <option value="กาฬสินธุ์">
                  <option value="กำแพงเพชร">
                  <option value="ขอนแก่น">
                  <option value="จันทบุรี">
                  <option value="ฉะเชิงเทรา">
                  <option value="ชลบุรี">
                  <option value="ชัยนาท">
                  <option value="ชัยภูมิ">
                  <option value="ชุมพร">
                  <option value="เชียงราย">
                  <option value="เชียงใหม่">
                  <option value="ตรัง">
                  <option value="ตราด">
                  <option value="ตาก">
                  <option value="นครนายก">
                  <option value="นครปฐม">
                  <option value="นครพนม">
                  <option value="นครราชสีมา">
                  <option value="นครศรีธรรมราช">
                  <option value="นครสวรรค์">
                  <option value="นนทบุรี">
                  <option value="นราธิวาส">
                  <option value="น่าน">
                  <option value="บึงกาฬ">
                  <option value="บุรีรัมย์">
                  <option value="ปทุมธานี">
                  <option value="ประจวบคีรีขันธ์">
                  <option value="ปราจีนบุรี">
                  <option value="ปัตตานี">
                  <option value="พระนครศรีอยุธยา">
                  <option value="พะเยา">
                  <option value="พังงา">
                  <option value="พัทลุง">
                  <option value="พิจิตร">
                  <option value="พิษณุโลก">
                  <option value="เพชรบุรี">
                  <option value="เพชรบูรณ์">
                  <option value="แพร่">
                  <option value="ภูเก็ต">
                  <option value="มหาสารคาม">
                  <option value="มุกดาหาร">
                  <option value="แม่ฮ่องสอน">
                  <option value="ยโสธร">
                  <option value="ยะลา">
                  <option value="ร้อยเอ็ด">
                  <option value="ระนอง">
                  <option value="ระยอง">
                  <option value="ราชบุรี">
                  <option value="ลพบุรี">
                  <option value="ลำปาง">
                  <option value="ลำพูน">
                  <option value="เลย">
                  <option value="ศรีสะเกษ">
                  <option value="สกลนคร">
                  <option value="สงขลา">
                  <option value="สตูล">
                  <option value="สมุทรปราการ">
                  <option value="สมุทรสงคราม">
                  <option value="สมุทรสาคร">
                  <option value="สระแก้ว">
                  <option value="สระบุรี">
                  <option value="สิงห์บุรี">
                  <option value="สุโขทัย">
                  <option value="สุพรรณบุรี">
                  <option value="สุราษฎร์ธานี">
                  <option value="สุรินทร์">
                  <option value="หนองคาย">
                  <option value="หนองบัวลำภู">
                  <option value="อ่างทอง">
                  <option value="อำนาจเจริญ">
                  <option value="อุดรธานี">
                  <option value="อุตรดิตถ์">
                  <option value="อุทัยธานี">
                  <option value="อุบลราชธานี">
                </datalist>
              </div>
            </div>
          </div>

          <!-- Row 3 -->
          <div class="row mb-4">
            <div class="col-9">
              <input type="text" name="cust_nm" class="form-control" placeholder="ลูกค้า" required>
            </div>
            <div class="col-3 d-flex align-items-center">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="newCustomerCheckbox"
                       name="new_customer_flag" value="1">
                <label class="form-check-label" for="newCustomerCheckbox">
                  ลูกค้าใหม่
                </label>
              </div>
            </div>
          </div>

          <!-- Order table -->
          <table class="table table-bordered mb-4" style="background:#ecf5d7">
            <thead>
              <tr>
                <th>รายการสั่งซื้อ</th><th>จำนวน</th><th>ราคา</th><th>แถม</th>
                <th>ลด</th><th>ส่งเสริมการขาย</th><th>จำนวนเงิน</th>
                <th class="NoPrint"></th><th class="NoPrint"></th><th>หมายเหตุ</th>
              </tr>
            </thead>
            <tbody id="TBody">
              <tr id="TRow">
                <td>
                  <input list="itemSelect" name="item_nm" class="form-control" style="width:200px">
                  <datalist id="itemSelect">
                    <option value="AMCARDIA 5"><option value="AMCARDIA 10">
                    <option value="DICLO SR 100"><option value="DOLONIL SR 100">
                    <!-- … all items … -->
                  </datalist>
                </td>
                <td><input type="number" name="qty" class="form-control text-end" onchange="Calc(this)"></td>
                <td><input type="number" name="rate" class="form-control text-end" onchange="Calc(this)"></td>
                <td><input type="number" name="give" class="form-control text-end" onchange="Calc(this)"></td>
                <td><input type="number" name="dis" class="form-control text-end" onchange="Calc(this)"></td>
                <td><input type="text" name="smp" class="form-control text-end" placeholder="ส."></td>
                <td><input type="number" name="amt" class="form-control text-end bg-success-subtle" readonly></td>
                <td class="NoPrint">
                  <button type="button" class="btn btn-danger" onclick="BtnDel(this)">X</button>
                </td>
                <td class="NoPrint">
                  <button type="button" class="btn btn-success" onclick="BtnAdd()">+</button>
                </td>
                <td><input type="text" name="note_nm" class="form-control" placeholder="หมายเหตุ"></td>
              </tr>
            </tbody>
          </table>

          <!-- Totals, credit, note -->
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="input-group mb-3">
                <span class="input-group-text">ทั้งหมด</span>
                <input type="number" id="FTotal" name="FTotal" class="form-control text-end" readonly>
              </div>
              <div class="input-group mb-3">
                <span class="input-group-text">เครดิต</span>
                <select name="credit" class="form-control">
                  <option value="">เลือกเครดิต</option>
                  <option value="เงินสด">เงินสด</option>
                  <option value="7 วัน">7 วัน</option>
                  <option value="30 วัน">30 วัน</option>
                  <option value="60 วัน">60 วัน</option>
                  <option value="90 วัน">90 วัน</option>
                  <option value="120 วัน">120 วัน</option>
                </select>
              </div>
            </div>
            <div class="col-md-6">
              <textarea name="note" class="form-control" placeholder="หมายเหตุ"></textarea>
            </div>
          </div>

          <!-- Submit + Loading -->
          <div class="row mb-3">
            <div class="col">
              <button type="button" id="submitButton" class="btn btn-success w-100" onclick="submitForm()">
                ส่งข้อมูล
              </button>
            </div>
          </div>
          <div id="loading" class="text-center mb-3" style="display:none">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <div>กำลังบันทึกข้อมูล…</div>
          </div>

        </div>
      </div>
    </form>
  </div>

  <!-- JS libs -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    function BtnAdd() {
      const v = $('#TRow').clone().appendTo('#TBody');
      v.removeAttr('id').find('input').val('');
    }
    function BtnDel(btn) {
      $(btn).closest('tr').remove();
      CalcTotals();
    }
    function Calc(elem) {
      const row = $(elem).closest('tr');
      const q = +row.find('input[name=qty]').val()||0;
      const r = +row.find('input[name=rate]').val()||0;
      row.find('input[name=amt]').val(q*r);
      CalcTotals();
    }
    function CalcTotals() {
      let sum=0;
      $('input[name=amt]').each((i,el)=> sum += +el.value||0);
      $('#FTotal').val(sum);
    }
    window.onload = ()=> {
      const d=new Date(), yy=String(d.getFullYear()).slice(-2), mm=String(d.getMonth()+1).padStart(2,'0');
      $('#keyInput').val(`inv${yy}${mm}-${Math.random().toString(36).slice(2,9)}`);
    };
    function submitForm(){
      // show loading
      $('#submitButton').prop('disabled',true);
      $('#loading').show();

      const fd = new FormData($('#myForm')[0]);
      $.ajax({
        url: 'https://script.google.com/macros/s/AKfycbwVYEOgtEy0dDJsAmsNDXX8BoGV0tC4KoA4PmKWzJ0EiHDxVAnS1qbE06bJJcSACkvf0w/exec',
        method: 'POST',
        data: fd,
        processData: false,
        contentType: false
      })
      .done(()=>{
        Swal.fire('สำเร็จ','ส่งข้อมูลเรียบร้อย','success')
          .then(()=> location.reload());
      })
      .fail(()=>{
        Swal.fire('ล้มเหลว','ไม่สามารถส่งข้อมูลได้','error');
      })
      .always(()=>{
        $('#loading').hide();
        $('#submitButton').prop('disabled',false);
      });
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous">
  </script>
</body>
</html>
